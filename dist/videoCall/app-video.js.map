{"version":3,"file":"app-video.js","sourceRoot":"","sources":["../../src/videoCall/app-video.ts"],"names":[],"mappings":"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","sourcesContent":["import {LitElement, html, css} from 'lit';\nimport {customElement, query, property} from 'lit/decorators.js';\nimport {LoginUser, Payload, PayloadType, UserStatus} from '../model';\n@customElement('app-video')\nexport class AppVideoCall extends LitElement {\n  static override styles = css`\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n      font-family: 'poppins', sans-serif;\n    }\n    .header {\n      width: 100%;\n      height: 100vh;\n      background: #00122e;\n      position: relative;\n    }\n    nav {\n      position: absolute;\n      top: 0;\n      left: 0;\n      bottom: 0;\n      background: #182842;\n      width: 120px;\n      padding: 10px 0;\n    }\n    nav .logo {\n      width: 56px;\n      display: block;\n      margin: auto;\n      cursor: pointer;\n    }\n    nav ul {\n      margin-top: 160px;\n    }\n    nav ul li {\n      list-style: none;\n    }\n    nav ul li img {\n      width: 50px;\n      display: block;\n      margin: 10px auto;\n      padding: 10px;\n      cursor: pointer;\n      opacity: 0.5;\n      border-radius: 10px;\n      transition: opacity 0.5s, background 0.5s;\n    }\n    nav ul li img:hover {\n      opacity: 1;\n      background: #4d6181;\n    }\n    .active {\n      opacity: 1;\n      background: #4d6181;\n    }\n    .container {\n      margin-left: 120px;\n      padding: 0 2.5%;\n    }\n    .top-icons {\n      display: flex;\n      align-items: center;\n      justify-content: flex-end;\n      padding: 25px 0;\n    }\n    .top-icons img {\n      width: 25px;\n      margin-left: 40px;\n      cursor: pointer;\n    }\n    .row {\n      margin-top: 15px;\n      display: flex;\n      justify-content: space-between;\n    }\n    .col-1 {\n      flex-basis: 65%;\n    }\n    .col-2 {\n      flex-basis: 33%;\n    }\n    .host-img {\n      width: 100%;\n      border-radius: 15px;\n    }\n    .contarols {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n    .contarols img {\n      width: 40px;\n      margin: 20px 10px;\n      cursor: pointer;\n      transition: transform 0.5s;\n    }\n    .contarols .call-icon {\n      width: 70px;\n    }\n    .contarols img:hover {\n      transform: translateY(-10px);\n    }\n    .joined {\n      background: #182842;\n      border-radius: 15px;\n      padding: 30px 40px 50px;\n      color: #fff;\n    }\n    .joined div {\n      margin-top: 20px;\n      display: grid;\n      grid-template-columns: auto auto auto;\n      grid-gap: 20px;\n    }\n    .joined img {\n      width: 100%;\n      border-radius: 10px;\n      cursor: pointer;\n    }\n    .invite {\n      background: #182842;\n      border-radius: 15px;\n      padding: 30px 40px 50px;\n      color: #fff;\n      margin-top: 20px;\n    }\n    .invite img {\n      margin-top: 20px;\n      width: 50px;\n      margin-left: 5px;\n      border-radius: 50%;\n      cursor: pointer;\n    }\n    #local-video {\n      height: 107px;\n    }\n  `;\n\n  @query('#local-video')\n  _localVideo: HTMLVideoElement | undefined;\n\n  @property()\n  status = UserStatus[UserStatus.offline];\n\n  @property()\n  webcam = false;\n\n  @property()\n  audio = false;\n\n  recieverName: string | undefined;\n\n  incomingCall: boolean;\n\n  loginUser: LoginUser | undefined;\n\n  websocket: WebSocket;\n\n  peerConnection: RTCPeerConnection;\n\n  //Configuration user name and password need to take from localstorage once websocket connection success.\n  configuration = {};\n\n  startMedia() {\n    navigator.mediaDevices\n      .getUserMedia({\n        audio: this.audio,\n        video: this.webcam,\n      })\n      .then((mediaStream: MediaStream) => {\n        if (this._localVideo != undefined) {\n          this._localVideo.srcObject = mediaStream;\n          this._localVideo.classList.remove('d-none');\n        }\n      })\n      .catch((err) => {\n        console.error(err);\n      });\n  }\n\n  sendStatusPayload(status: UserStatus) {\n    this.websocket.send(\n      JSON.stringify({\n        type: PayloadType[PayloadType.status],\n        status: UserStatus[status],\n        recieverUserName: 'server',\n        sendUser: {\n          username: this.loginUser?.username,\n        },\n      })\n    );\n  }\n\n  sendOfferPayload(offer: object, recieverUsername: string) {\n    this.websocket.send(\n      JSON.stringify({\n        type: PayloadType[PayloadType.offer],\n        recieverUserName: recieverUsername,\n        offer: offer,\n        sendUser: {\n          username: this.loginUser?.username,\n        },\n      })\n    );\n  }\n\n  sendAnswerPayload(answer: object, recieverUserName: string) {\n    this.websocket.send(\n      JSON.stringify({\n        type: PayloadType[PayloadType.offer],\n        recieverUserName: recieverUserName,\n        answer: answer,\n        sendUser: {\n          username: this.loginUser?.username,\n        },\n      })\n    );\n  }\n\n  serverListner() {\n    this.websocket.onopen = () => {\n      this.sendStatusPayload(UserStatus.online);\n    };\n    this.websocket.onmessage = (ev: MessageEvent) => {\n      const payload: Payload = JSON.parse(ev.data) as Payload;\n      switch (payload.type.toString()) {\n        case PayloadType[PayloadType.status]:\n          this.status = `${payload.status}`;\n          break;\n\n        case PayloadType[PayloadType.ring]:\n          alert(`Incoming call from ${payload.sendUser.username}`);\n          break;\n\n        default:\n          alert(JSON.stringify(payload));\n          break;\n      }\n    };\n    this.websocket.onclose = () => {\n      console.log('redirect to login');\n    };\n\n    this.websocket.onerror = () => {\n      this.websocket.close();\n    };\n  }\n\n  async createCall(recieverName: string) {\n    const offer = await this.peerConnection.createOffer();\n    await this.peerConnection.setLocalDescription(offer);\n    this.sendOfferPayload(offer, recieverName);\n  }\n\n  async callStarted(answer: RTCSessionDescriptionInit) {\n    const remoteDesc = new RTCSessionDescription(answer);\n    await this.peerConnection.setRemoteDescription(remoteDesc);\n  }\n\n  async answerCall(recieverName: string, offer: RTCSessionDescriptionInit) {\n    this.peerConnection.setRemoteDescription(new RTCSessionDescription(offer));\n    const answer = await this.peerConnection.createAnswer();\n    await this.peerConnection.setLocalDescription(answer);\n    this.sendAnswerPayload(answer, recieverName);\n  }\n\n  constructor() {\n    super();\n    this.incomingCall = false;\n    try {\n      this.loginUser = JSON.parse(\n        `${localStorage.getItem('user')}`\n      ) as LoginUser;\n    } catch (err) {\n      console.log('redirect to login');\n    }\n    this.startMedia();\n    this.websocket = new WebSocket(\n      `ws://localhost:9090/server?token=${this.loginUser?.username}:${this.loginUser?.password}&from=${this.loginUser?.username}`\n    );\n    this.serverListner();\n    this.configuration = {\n      iceServers: [\n        {\n          urls: 'stun:172.16.0.2:3478',\n        },\n        {\n          urls: 'turn:172.16.0.2:3478',\n          username: this.loginUser?.username,\n          credential: this.loginUser?.password,\n        },\n      ],\n    };\n    this.peerConnection = new RTCPeerConnection(this.configuration);\n  }\n\n  override render() {\n    return html`\n      <div class=\"container\">\n      <div class=\"top-icons\">\n          <img src=\"https://i.postimg.cc/cCpcXrSV/search.png\">\n          <img src=\"https://i.postimg.cc/Pqy2TXWw/menu.png\">\n      </div>\n      <div class=\"row\">\n          <div class=\"col-1\">\n              <img src=\"https://i.postimg.cc/521rVkhD/image.png\" class=\"host-img\">\n              <div class=\"contarols\">\n                  <img src=\"https://i.postimg.cc/3NVtVtgf/chat.png\">\n                  <img src=\"https://i.postimg.cc/BQPYHG0r/disconnect.png\">\n                  <img src=\"https://i.postimg.cc/fyJH8G00/call.png\" class=\"call-icon\">\n                  <img src=\"https://i.postimg.cc/bJFgSmFY/mic.png\">\n                  <img src=\"https://i.postimg.cc/Y2sDvCJN/cast.png\">\n              </div>\n          </div>\n          <div class=\"col-2\">\n              <div class=\"joined\">\n                  <p>People Joined</p>\n                  <div>\n                    <video class=\"d-none\" id=\"local-video\" autoplay=\"\"></video>\n                  </div>\n              </div>\n              <div class=\"invite\">\n                  <p>Invite More People</p>\n                  <div>\n                      <img src=\"https://i.postimg.cc/7LHjgQXS/user-1.png\">\n                  </div>\n              </div>\n          </div>\n      </div>\n  </div>\n</div>\n    `;\n  }\n}\n"]}